ssrf无回显:
- 
防护php反序列化:
- 使用json_decode和json_encode代替
- php7提供了allow_classes参数
- 将序列化的对象存储在数据库中并将唯一标识符传递给浏览器,然后从数据库中读取序列化数据

绕过CDN:
- 查询dns历史记录,可能会有之前的IP记录
- 查询子域名,可能没有CDN
- SSL证书
- 多地PING
子域名泛解析:
- 先产生一个随机不可能的域名,然后确认泛解析,通过产生随机域名构建IP黑名单,然后排除黑名单外的IP
- 通过比对网页内容判断是否为泛解析

CC1:
```bash
->AnnotationInvocationHandler.readObject()
      ->mapProxy.entrySet().iterator()  //动态代理类
          ->AnnotationInvocationHandler.invoke()
            ->LazyMap.get()
                ->ChainedTransformer.transform()
                ->ConstantTransformer.transform()
                    ->InvokerTransformer.transform()
                    ->…………
```

CC3:
```bash
->AnnotationInvocationHandler.readObject()
      ->mapProxy.entrySet().iterator()  //动态代理类
          ->AnnotationInvocationHandler.invoke()
            ->LazyMap.get()
                ->ChainedTransformer.transform()
                    ->ConstantTransformer.transform()
                        ->InstantiateTransformer.transform()
                            ->TrAXFilter.TrAXFilter()
                                ->TemplatesImpl.newTransformer()
                                    ->…………
```

CC4:
```bash
->PriorityQueue.readObject()
      ->PriorityQueue.heapify()
          ->PriorityQueue.siftDown()
            ->PriorityQueue.siftDownUsingComparator()
                 ->TransformingComparator.compare()
                    ->ChainedTransformer.transform()
                        ->ConstantTransformer.transform()
                                    ->InstantiateTransformer.transform()
                             ->TrAXFilter.TrAXFilter()
                                 ->TemplatesImpl.newTransformer()
                                        ->…………
```
CC5:

```bash
->BadAttributeValueExpException.readObject()
      ->TiedMapEntry.toString()
          ->TiedMapEntry.getValue()
            ->LazyMap.get()
                ->ChainedTransformer.transform()
                    ->ConstantTransformer.transform()
                            ->InvokerTransformer.transform()
                                ->…………
```

CC7
```bash
  ->HashMap.readObject()
      ->HashMap.putForCreate()
          ->HashMap.hash()
            ->TiedMapEntry.hashCode()
                    ->TiedMapEntry.getValue()
                    ->LazyMap.get()
                      ->ChainedTransformer.transform()
                          ->ConstantTransformer.transform()
                              ->InvokerTransformer.transform()
                                  ->…………
```

fastjson 1.2.24:
> 构造一个 TemplatesImpl 类的反序列化字符串，其中 \_bytecodes 是我们构造的恶意类的类字节码，这个类的父类是 AbstractTranslet，最终这个类会被加载并使用 newInstance() 实例化。
在反序列化过程中，由于getter方法 getOutputProperties()，满足条件，将会被 fastjson 调用，而这个方法触发了整个漏洞利用流程：getOutputProperties() -> newTransformer() -> getTransletInstance() -> defineTransletClasses() / EvilClass.newInstance().


```bash
com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl.readObject()
	->_bytescode.newInstance()
		->
```

JdbcRowSetImpl 反序列化
```bash
com.sun.rowset.JdbcRowSetImpl.readObject()
	->setAutoCommit()
		->connect()
			->lookup(dataSource)
```

1.2.25:
引入了 checkAutoType安全机制,通过autoTypeSupport确认是否允许反序列化任意类
> 看一下 checkAutoType() 的逻辑，如果开启了 autoType，先判断类名是否在白名单中，如果在，就使用 TypeUtils.loadClass 加载，然后使用黑名单判断类名的开头，如果匹配就抛出异常。


